{"version":3,"names":["loadCache","name","cacheRaw","fs","readFileSync","path","resolve","getCacheRootPath","cache","JSON","parse","e","code","saveCache","logger","debug","undefined","fullPath","mkdirSync","dirname","recursive","writeFileSync","stringify","legacyPath","os","homedir","cachePath","appDirs","appName","existsSync","get","key","set","value"],"sources":["../src/cacheManager.ts"],"sourcesContent":["import path from 'path';\nimport fs from 'fs';\nimport os from 'os';\nimport appDirs from 'appdirsjs';\nimport logger from './logger';\n\ntype CacheKey = 'eTag' | 'lastChecked' | 'latestVersion' | 'dependencies';\ntype Cache = {[key in CacheKey]?: string};\n\nfunction loadCache(name: string): Cache | undefined {\n  try {\n    const cacheRaw = fs.readFileSync(\n      path.resolve(getCacheRootPath(), name),\n      'utf8',\n    );\n    const cache = JSON.parse(cacheRaw);\n    return cache;\n  } catch (e) {\n    if ((e as any).code === 'ENOENT') {\n      // Create cache file since it doesn't exist.\n      saveCache(name, {});\n    }\n    logger.debug('No cache found');\n    return undefined;\n  }\n}\n\nfunction saveCache(name: string, cache: Cache) {\n  const fullPath = path.resolve(getCacheRootPath(), name);\n\n  fs.mkdirSync(path.dirname(fullPath), {recursive: true});\n  fs.writeFileSync(fullPath, JSON.stringify(cache, null, 2));\n}\n\n/**\n * Returns the path string of `$HOME/.react-native-cli`.\n *\n * In case it doesn't exist, it will be created.\n */\nfunction getCacheRootPath() {\n  const legacyPath = path.resolve(os.homedir(), '.react-native-cli', 'cache');\n  const cachePath = appDirs({appName: 'react-native-cli', legacyPath}).cache;\n\n  if (!fs.existsSync(cachePath)) {\n    fs.mkdirSync(cachePath, {recursive: true});\n  }\n\n  return cachePath;\n}\n\nfunction get(name: string, key: CacheKey): string | undefined {\n  const cache = loadCache(name);\n  if (cache) {\n    return cache[key];\n  }\n  return undefined;\n}\n\nfunction set(name: string, key: CacheKey, value: string) {\n  const cache = loadCache(name);\n  if (cache) {\n    cache[key] = value;\n    saveCache(name, cache);\n  }\n}\n\nexport default {\n  get,\n  set,\n};\n"],"mappings":";;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;AAA8B;AAK9B,SAASA,SAAS,CAACC,IAAY,EAAqB;EAClD,IAAI;IACF,MAAMC,QAAQ,GAAGC,aAAE,CAACC,YAAY,CAC9BC,eAAI,CAACC,OAAO,CAACC,gBAAgB,EAAE,EAAEN,IAAI,CAAC,EACtC,MAAM,CACP;IACD,MAAMO,KAAK,GAAGC,IAAI,CAACC,KAAK,CAACR,QAAQ,CAAC;IAClC,OAAOM,KAAK;EACd,CAAC,CAAC,OAAOG,CAAC,EAAE;IACV,IAAKA,CAAC,CAASC,IAAI,KAAK,QAAQ,EAAE;MAChC;MACAC,SAAS,CAACZ,IAAI,EAAE,CAAC,CAAC,CAAC;IACrB;IACAa,eAAM,CAACC,KAAK,CAAC,gBAAgB,CAAC;IAC9B,OAAOC,SAAS;EAClB;AACF;AAEA,SAASH,SAAS,CAACZ,IAAY,EAAEO,KAAY,EAAE;EAC7C,MAAMS,QAAQ,GAAGZ,eAAI,CAACC,OAAO,CAACC,gBAAgB,EAAE,EAAEN,IAAI,CAAC;EAEvDE,aAAE,CAACe,SAAS,CAACb,eAAI,CAACc,OAAO,CAACF,QAAQ,CAAC,EAAE;IAACG,SAAS,EAAE;EAAI,CAAC,CAAC;EACvDjB,aAAE,CAACkB,aAAa,CAACJ,QAAQ,EAAER,IAAI,CAACa,SAAS,CAACd,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;AAC5D;;AAEA;AACA;AACA;AACA;AACA;AACA,SAASD,gBAAgB,GAAG;EAC1B,MAAMgB,UAAU,GAAGlB,eAAI,CAACC,OAAO,CAACkB,aAAE,CAACC,OAAO,EAAE,EAAE,mBAAmB,EAAE,OAAO,CAAC;EAC3E,MAAMC,SAAS,GAAG,IAAAC,oBAAO,EAAC;IAACC,OAAO,EAAE,kBAAkB;IAAEL;EAAU,CAAC,CAAC,CAACf,KAAK;EAE1E,IAAI,CAACL,aAAE,CAAC0B,UAAU,CAACH,SAAS,CAAC,EAAE;IAC7BvB,aAAE,CAACe,SAAS,CAACQ,SAAS,EAAE;MAACN,SAAS,EAAE;IAAI,CAAC,CAAC;EAC5C;EAEA,OAAOM,SAAS;AAClB;AAEA,SAASI,GAAG,CAAC7B,IAAY,EAAE8B,GAAa,EAAsB;EAC5D,MAAMvB,KAAK,GAAGR,SAAS,CAACC,IAAI,CAAC;EAC7B,IAAIO,KAAK,EAAE;IACT,OAAOA,KAAK,CAACuB,GAAG,CAAC;EACnB;EACA,OAAOf,SAAS;AAClB;AAEA,SAASgB,GAAG,CAAC/B,IAAY,EAAE8B,GAAa,EAAEE,KAAa,EAAE;EACvD,MAAMzB,KAAK,GAAGR,SAAS,CAACC,IAAI,CAAC;EAC7B,IAAIO,KAAK,EAAE;IACTA,KAAK,CAACuB,GAAG,CAAC,GAAGE,KAAK;IAClBpB,SAAS,CAACZ,IAAI,EAAEO,KAAK,CAAC;EACxB;AACF;AAAC,eAEc;EACbsB,GAAG;EACHE;AACF,CAAC;AAAA"}